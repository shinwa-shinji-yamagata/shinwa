スプレッドシートAPIを使って以下の処理を行っています。
「1日」～「31日」までのシートを読み込む。
C列を現場名、L列を人工として、データは5行目から入力されている。
C5～100行までの中にランダムで現場名が入力されている。（未記入のセルも多数ある）
L5～100行までの中に、対応するC列に現場名が入っていれば人工が数字で入力されている。（未記入の可能性もある）
「1日」～「31日」までのシートでループし、現場名と人工の連想配列に格納する。
「1日」～「31日」までのシートには、同一の現場名が複数存在し、その場合は人工を足し合わせる。
連想配列を現場名をキーにして昇順にソートする。
「月集計」シートのB列4行目から連想配列の現場名を書き込む。
「月集計」シートのC列4行目から連想配列の人工を書き込む。

現在のPHPプログラム（抜粋）は以下の通り

$spreadsheetId = getSpreadsheetId($drive, $yearFolderId, $currentMonth);

// 集計処理
$siteTotals = [];
for ($day = 1; $day <= 31; $day++) {
    $sheetName = "{$day}日";
    $range = "{$sheetName}!C5:L104";
    try {
        $response = $sheets->spreadsheets_values->get($spreadsheetId, $range);
        $rows = $response->getValues();
        if (is_array($rows)) {
            foreach ($rows as $row) {
                $site = isset($row[0]) ? preg_replace("/\r\n|\r|\n/", '', $row[0]) : '';
                $manpower = isset($row[9]) ? normalizeManpower($row[9]) : 0;
                if ($site !== '') {
                    if (!isset($siteTotals[$site])) $siteTotals[$site] = 0;
                    $siteTotals[$site] += $manpower;
                }
            }
        }
    } catch (Exception $e) {
        continue;
    }
}

// キー（現場名）で昇順にソート
ksort($siteTotals);

// 月集計のB4:C300をクリア
$clearRange = '月集計!B4:C300';
$emptyRows = [];
for ($i = 0; $i < 297; $i++) {
    $emptyRows[] = ['', ''];
}
$clearBody = new Google_Service_Sheets_ValueRange([
    'values' => $emptyRows
]);

$sheets->spreadsheets_values->update(
    $spreadsheetId,
    $clearRange,
    $clearBody,
    ['valueInputOption' => 'USER_ENTERED']
);

// 月集計シートに書き込み
$updateData = [];
foreach ($siteTotals as $site => $total) {
    $updateData[] = [$site, $total];
}
$body = new Google_Service_Sheets_ValueRange([
    'values' => $updateData
]);
$sheets->spreadsheets_values->update(
    $spreadsheetId,
    '月集計!B4:C' . (count($updateData) + 3),
    $body,
    ['valueInputOption' => 'USER_ENTERED']
);

function normalizeManpower($value) {
    // 全角数字を半角に変換（数字・小数点・マイナス記号など）
    $value = mb_convert_kana($value, 'a');

    // 数字として認識できるかチェック
    if (is_numeric($value)) {
        return floatval($value);
    } else {
        return 0;
    }
}

このプログラムに以下の改修をすることになりました。
「1日」～「31日」シートのN列5行目以降に現場名に対応した「外注」という要素が入る場合がある。
「外注」に書き込まれるパターンは以下のように、文字を「、」または「,」で区切ったもの。
区切り文字で分割した要素数を外注の数として計上する。（要素が空文字の場合は計上しない）
例1：山田
例2：山田、谷口、藤田
例3：山田、谷口,藤田、
例1の場合は、外注の数を1として現場名毎の多次元配列に人工とは別に外注として格納する。
例2と例3の場合は、外注の数を3として現場名毎の多次元配列に人工とは別に外注として格納する。
多次元配列を現場名をキーにして昇順ソートする。
「月集計」シートで、B列4行目からD列300行目までのセルをクリアする。
「月集計」シートで、現場名と人工は既存通りに書き込み、D列4行目からは現場名に対応して集計した外注の数字を書き込む。
この時、人工及び外注の集計結果がどちらも0の場合は現場名を含む多次元配列は書き込まない。（多次元配列のループをスキップ）
また、人工が0より大きく、外注が0の場合は人工を書き込むが、外注は書き込まず空のままとする。
逆に、人工が0で外注が0より大きい場合、人工に0を書き込み、外注は集計した数字を書き込む。

この改修をしたPHPコードを書いてください。

